name: CTSE-Assignment-02

on:
  push:
    branches: [ code_setup ]
  workflow_dispatch:

env:
  DOCKER_USER_NAME: ${{secrets.DOCKER_USER_NAME}}
  DOCKER_PASSWORD: ${{secrets.DOCKER_PASSWORD}}
  PRODUCT_REPO_NAME: ${{secrets.PRODUCT_REPO_NAME}}
  # PROJECT_ID: ${{secrets.GKE_PROJECT}}
  # GKE_CLUSTER: clay-cluster-1
  # GKE_ZONE: us-central1
  # DEPLOYMENT_NAME: github-actions-gke-deployment
  # IMAGE: github-actions-gke-image
  # TAG: 1.0.0 

jobs:
  eslint:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v2
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '20'
    - name: Install dependencies
      run: npm install
      working-directory: product_service
    - name: Run ESLint
      run: npx eslint . --rule "@typescript-eslint/naming-convention:off" --rule "@typescript-eslint/object-curly-spacing:off" --rule "semi:off" --rule "quotes:off" --rule "space-in-parens:off"
      working-directory: product_service

  product-service:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Docker login
      run: |
        docker login -u $DOCKER_USER_NAME -p $DOCKER_PASSWORD
    - name: Build product service docker image
      run: |
        cd product_service
        docker build . --file Dockerfile --tag $DOCKER_USER_NAME/$PRODUCT_REPO_NAME
    - name: Push user service docker image
      run: docker push $DOCKER_USER_NAME/$PRODUCT_REPO_NAME


  # deploy:
  #   needs: [product-service]
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: üõ† Configure Kubernetes Credentials
  #     uses: GoogleCloudPlatform/github-actions/setup-gcloud@0.1.3
  #     env:
  #       ACTIONS_ALLOW_UNSECURE_COMMANDS: true
  #     with:
  #       service_account_key: ${{secrets.GKE_SA_KEY}}
  #       project_id: ${{secrets.GKE_PROJECT}}
  #   - name: ‚¨ÜÔ∏è Deploy to K8s
  #     run: gcloud container clusters get-credentials "$GKE_CLUSTER" --zone "$GKE_ZONE"
           